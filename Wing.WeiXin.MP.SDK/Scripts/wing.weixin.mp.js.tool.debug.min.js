/*!
 * Weixin JS Debug Tool v0.0.4
 * 用于图形化调试程序
 *
 * Dependency：
 * 1.JQuery
 * 2.Bootstrap(V3)
 *
 * Update(v0.0.4)：
 * [Change]调整MsgID生成机制
 * 
 * Usage：
 * $('#main').weixindebug({
 *     submitMessageUrl: '/DebugTool?Mode=SubmitMessage', //提交消息URL
 *     refreshServerUrl: '/DebugTool?Mode=RefreshServer', //重启服务器URL
 *     account: '',                                       //默认微信账号
 *     openid: ''                                         //默认OpenID
 * });
 */
!function (a) { "use strict"; function f(a) { a.html('<div role="tabpanel"><ul class="nav nav-tabs" role="tablist"><li role="presentation" class="active"><a href="#' + d + 'tab-test-text" aria-controls="' + d + 'tab-test-text" role="tab" data-toggle="tab">调试文本消息</a>' + "</li>" + '<li role="presentation">' + '<a href="#' + d + 'tab-test-event-click" aria-controls="' + d + 'tab-test-event-click" role="tab" data-toggle="tab">调试菜单Click消息</a>' + "</li>" + '<li role="presentation">' + '<a href="#' + d + 'tab-test-custom" aria-controls="' + d + 'tab-test-custom" role="tab" data-toggle="tab">调试自定义消息</a>' + "</li>" + '<li role="presentation">' + '<a href="#' + d + 'tab-server" aria-controls="' + d + 'tab-server" role="tab" data-toggle="tab">服务器操作</a>' + "</li>" + "</ul>" + '<div class="tab-content">' + '<div role="tabpanel" class="tab-pane active" id="' + d + 'tab-test-text">' + '<div class="form-group">' + '<label for="' + d + 'tab-test-text-account" class="sr-only">微信账号</label>' + '<div class="input-group">' + '<input type="text" id="' + d + 'tab-test-text-account" name="account" class="form-control" placeholder="微信账号" value="' + e.account + '">' + '<div class="input-group-addon">' + '<button class="glyphicon glyphicon-flag"></button>' + "</div>" + "</div>" + "</div>" + '<div class="form-group">' + '<label for="' + d + 'tab-test-text-open-id" class="sr-only">微信用户OpenID</label>' + '<div class="input-group">' + '<input type="text" id="' + d + 'tab-test-text-open-id" name="open-id" class="form-control" placeholder="微信用户OpenID" value="' + e.openid + '">' + '<div class="input-group-addon">' + '<button class="glyphicon glyphicon-user"></button>' + "</div>" + "</div>" + "</div>" + '<div class="form-group">' + '<label for="' + d + 'tab-test-text-content" class="sr-only">文本消息内容</label>' + '<div class="input-group">' + '<input type="text" id="' + d + 'tab-test-text-content" name="content" class="form-control" placeholder="文本消息内容">' + '<div class="input-group-addon">' + '<button class="glyphicon glyphicon-file"></button>' + "</div>" + "</div>" + "</div>" + '<div class="form-group">' + '<button type="button" class="btn btn-primary" id="' + d + 'tab-test-text-submit">提交</button>' + "</div>" + "</div>" + '<div role="tabpanel" class="tab-pane" id="' + d + 'tab-test-event-click">' + '<div class="form-group">' + '<label for="' + d + 'tab-test-event-click-account" class="sr-only">微信账号</label>' + '<div class="input-group">' + '<input type="text" id="' + d + 'tab-test-event-click-account" name="account" class="form-control" placeholder="微信账号" value="' + e.account + '">' + '<div class="input-group-addon">' + '<button class="glyphicon glyphicon-flag"></button>' + "</div>" + "</div>" + "</div>" + '<div class="form-group">' + '<label for="' + d + 'tab-test-event-click-open-id" class="sr-only">微信用户OpenID</label>' + '<div class="input-group">' + '<input type="text" id="' + d + 'tab-test-event-click-open-id" name="open-id" class="form-control" placeholder="微信用户OpenID" value="' + e.openid + '">' + '<div class="input-group-addon">' + '<button class="glyphicon glyphicon-user"></button>' + "</div>" + "</div>" + "</div>" + '<div class="form-group">' + '<label for="' + d + 'tab-test-event-click-event-key" class="sr-only">事件Key</label>' + '<div class="input-group">' + '<input type="text" id="' + d + 'tab-test-event-click-event-key" name="event-key" class="form-control" placeholder="事件Key">' + '<div class="input-group-addon">' + '<button class="glyphicon glyphicon-file"></button>' + "</div>" + "</div>" + "</div>" + '<div class="form-group">' + '<button type="button" class="btn btn-primary" id="' + d + 'tab-test-event-click-submit">提交</button>' + "</div>" + "</div>" + '<div role="tabpanel" class="tab-pane" id="' + d + 'tab-test-custom">' + '<div class="form-group">' + '<label for="' + d + 'tab-test-custom-content" class="sr-only">正文</label>' + '<div class="input-group">' + '<textarea id="' + d + 'tab-test-custom-content" name="content" class="form-control" rows="10" placeholder="正文"></textarea>' + '<div class="input-group-addon">' + '<button class="glyphicon glyphicon-file"></button>' + "</div>" + "</div>" + "</div>" + '<div class="form-group">' + '<button type="button" class="btn btn-primary" id="' + d + 'tab-test-custom-submit">提交</button>' + "</div>" + "</div>" + '<div role="tabpanel" class="tab-pane" id="' + d + 'tab-server">' + '<div class="btn-group" role="group">' + '<button type="button" id="' + d + 'tab-server-refrush-server" class="btn btn-primary">重启服务器</button>' + "</div>" + "</div>" + "</div>" + "</div>"), g() } function g() { a("#" + d + "tab-test-text-submit").click(function () { h() }), a("#" + d + "tab-test-event-click-submit").click(function () { j() }), a("#" + d + "tab-test-custom-submit").click(function () { k() }), a("#" + d + "tab-server-refrush-server").click(function () { l() }) } function h() { var c, e, b = a("#" + d + "tab-test-text-account").val(); return b.length < 1 ? (r("微信账号不能为空"), void 0) : (c = a("#" + d + "tab-test-text-open-id").val(), c.length < 1 ? (r("OpenID不能为空"), void 0) : (e = a("#" + d + "tab-test-text-content").val(), m("<xml><ToUserName><![CDATA[" + b + "]]></ToUserName>" + "<FromUserName><![CDATA[" + c + "]]></FromUserName> " + "<CreateTime>1348831860</CreateTime>" + "<MsgType><![CDATA[text]]></MsgType>" + "<Content><![CDATA[" + e + "]]></Content>" + "<MsgId>" + i() + "</MsgId>" + "</xml>"), void 0)) } function i() { return "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g, function (a) { var b = 0 | 16 * Math.random(), c = "x" === a ? b : 8 | 3 & b; return c.toString(16) }) } function j() { var c, e, b = a("#" + d + "tab-test-event-click-account").val(); return b.length < 1 ? (r("微信账号不能为空"), void 0) : (c = a("#" + d + "tab-test-event-click-open-id").val(), c.length < 1 ? (r("OpenID不能为空"), void 0) : (e = a("#" + d + "tab-test-event-click-event-key").val(), e.length < 1 ? (r("事件Key不能为空"), void 0) : (m("<xml><ToUserName><![CDATA[" + b + "]]></ToUserName>" + "<FromUserName><![CDATA[" + c + "]]></FromUserName>" + "<CreateTime>123456789</CreateTime>" + "<MsgType><![CDATA[event]]></MsgType>" + "<Event><![CDATA[CLICK]]></Event>" + "<EventKey><![CDATA[" + e + "]]></EventKey>" + "</xml>"), void 0))) } function k() { var b = a("#" + d + "tab-test-custom-content").val(); return b.length < 1 ? (r("正文不能为空"), void 0) : (m(b), void 0) } function l() { o("确定刷新服务器?", function () { p(), a.getJSON(e.refreshServerUrl, function (a) { q(), r(a.msg) }) }) } function m(b) { p(), a.post(e.submitMessageUrl, { Data: window.escape(b) }, function (a) { return "undefined" != typeof a.msg ? (q(), r(a.msg), void 0) : (q(), n(a.data), void 0) }, "json") } function n(b) { a("body").append('<div id="' + d + 'show-result" class="modal fade" role="dialog" aria-hidden="true">' + '<div class="modal-dialog">' + '<div class="modal-content">' + '<div class="modal-header">' + '<h4 class="modal-title">测试消息结果</h4>' + "</div>" + '<div class="modal-body">' + "<p><strong>" + b + "</strong></p>" + "</div>" + '<div class="modal-footer">' + '<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>' + "</div>" + "</div>" + "</div>" + "</div>"), a("#" + d + "show-result").on("hidden.bs.modal", function () { a(this).remove() }), a("#" + d + "show-result").modal("show") } function o(b, c) { a("body").append('<div id="' + d + 'confirm" class="modal fade" role="dialog" aria-hidden="true">' + '<div class="modal-dialog">' + '<div class="modal-content">' + '<div class="modal-header">' + '<h4 class="modal-title">提示</h4>' + "</div>" + '<div class="modal-body">' + "<p><strong>" + b + "</strong></p>" + "</div>" + '<div class="modal-footer">' + '<button type="button" id="' + d + 'confirm-ok" class="btn btn-primary">确定</button>' + '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>' + "</div>" + "</div>" + "</div>" + "</div>"), a("#" + d + "confirm").on("hidden.bs.modal", function () { a(this).remove() }), a("#" + d + "confirm-ok").click(function () { c(), a("#" + d + "confirm").modal("hide") }), a("#" + d + "confirm").modal("show") } function p() { a("body").append('<div id="' + d + 'loading" class="modal fade" data-backdrop="static">' + '<div class="modal-dialog">' + '<div class="modal-content">' + '<div class="modal-body">' + "<p>Loading。。。</p>" + "</div>" + "</div>" + "</div>" + "</div>"), a("#" + d + "loading").on("hidden.bs.modal", function () { a(this).remove() }), a("#" + d + "loading").modal("show") } function q() { a("#" + d + "loading").modal("hide") } function r(b) { a("body").append('<div id="' + d + 'message-alert" class="alert alert-info alert-dismissible fade in" role="alert" style="display:none;z-index:9999;position:fixed;left:0;top:0;right:0">' + "<strong>" + b + "</strong>" + "</div>"), a("#" + d + "message-alert").slideDown("fast"), setTimeout(function () { a("#" + d + "message-alert").alert("close") }, c) } var e, b = "weixindebug", c = 2e3, d = "weixin-tool-debug-"; a.fn[b] = function (b) { e = a.extend({ submitMessageUrl: "/DebugTool?Mode=SubmitMessage", refreshServerUrl: "/DebugTool?Mode=RefreshServer", account: "", openid: "" }, b), f(a(this)) } }(jQuery);